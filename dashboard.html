<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LiveCard Studio - Create Card</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="card-render.js"></script>
<style>
:root{
  --bg:#fdf8f0;--panel:#fff9f2;--line:rgba(200,160,120,.28);--text:#3a2f2a;--muted:#8b6f5e;
  --brand:#c87941;--brand-soft:rgba(200,121,65,.12);--ok:#4f7b56;--danger:#b15757;
}
*{box-sizing:border-box}html,body{margin:0;padding:0}
body{font-family:Inter,sans-serif;background:var(--bg);color:var(--text)}
.topbar{
  position:sticky;top:0;z-index:30;background:rgba(253,248,240,.94);backdrop-filter:blur(12px);
  border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between;padding:14px 18px;
}
.logo{font-family:Playfair Display,serif;color:var(--brand);font-size:1.35rem;text-decoration:none}
.logo span{color:#9f6b4a}
.user-actions{display:flex;gap:10px;align-items:center}
.user-email{font-size:.78rem;color:var(--muted);max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.btn{
  border:1px solid var(--line);background:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;
  font:500 .78rem/1 Inter,sans-serif;letter-spacing:.08em;text-transform:uppercase;color:#5a4a3f;
}
.btn:hover{border-color:rgba(200,121,65,.5);color:var(--brand)}
.btn.brand{background:var(--brand);color:#fff;border-color:transparent}
.btn.brand:hover{filter:brightness(1.04)}
.page{max-width:1300px;margin:0 auto;padding:20px 14px 40px}
.cardshelf{
  background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;display:none;margin-bottom:16px;
}
.cardshelf-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.cardshelf h2{margin:0;font:600 1.1rem/1.2 Playfair Display,serif}
.cardshelf-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px}
.card-chip{border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px}
.card-chip-title{font:600 .86rem/1.2 Inter,sans-serif;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.card-chip-sub{margin-top:4px;color:var(--muted);font-size:.72rem}
.card-chip-actions{margin-top:8px;display:flex;gap:6px}
.card-chip-actions button,.card-chip-actions a{
  border:1px solid var(--line);background:#fff;border-radius:8px;padding:5px 8px;font-size:.68rem;color:#5a4a3f;text-decoration:none
}
.wizard{
  background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:18px;
}
.wizard-head h1{margin:0;font:600 1.7rem/1.2 Playfair Display,serif}
.wizard-head p{margin:6px 0 0;color:var(--muted);font-size:.9rem}
.progress{margin-top:14px;height:8px;background:#f0e5d9;border-radius:999px;overflow:hidden}
.progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand),#d4a574);transition:width .25s ease}
.step-track{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:8px;margin-top:10px}
.step-chip{
  border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 8px;min-height:44px;
  font:500 .7rem/1.2 Inter,sans-serif;color:#7a6555;text-transform:uppercase;letter-spacing:.05em;
}
.step-chip.active{border-color:rgba(200,121,65,.5);background:var(--brand-soft);color:var(--brand)}
.wizard-grid{display:grid;grid-template-columns:minmax(0,1fr) 380px;gap:16px;margin-top:16px}
.panel{display:none}
.panel.active{display:block}
.section-title{font:600 1.1rem/1.3 Playfair Display,serif;margin:0 0 10px}
.occasion-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px}
.occasion{
  border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px;text-align:center;cursor:pointer
}
.occasion.active{border-color:rgba(200,121,65,.5);background:var(--brand-soft)}
.occasion b{display:block;font-size:1.2rem}
.occasion span{display:block;font-size:.76rem;margin-top:4px}
.field{display:flex;flex-direction:column;gap:6px;margin-top:10px}
.field label{font:600 .72rem/1.2 Inter,sans-serif;letter-spacing:.08em;text-transform:uppercase;color:#6f5a4c}
.field input,.field textarea,.field select{
  border:1px solid var(--line);background:#fff;border-radius:10px;padding:10px 12px;font:500 .9rem/1.4 Inter,sans-serif;color:#3a2f2a;
}
.field textarea{min-height:120px;resize:vertical}
.dropzone{
  margin-top:10px;border:1.5px dashed var(--line);background:#fff;border-radius:14px;padding:26px 16px;text-align:center;cursor:pointer
}
.dropzone.drag{border-color:rgba(200,121,65,.55);background:var(--brand-soft)}
.photo-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;margin-top:12px}
.photo-item{border:1px solid var(--line);background:#fff;border-radius:12px;padding:8px}
.photo-item img{width:100%;height:130px;object-fit:cover;border-radius:10px}
.photo-actions{display:flex;gap:6px;margin-top:6px}
.photo-actions button{flex:1}
.theme-grid,.music-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:8px}
.theme-card,.music-card{
  border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px;cursor:pointer
}
.theme-card.active,.music-card.active{border-color:rgba(200,121,65,.5);background:var(--brand-soft)}
.swatches{display:flex;gap:4px;margin-bottom:8px}
.swatches i{width:14px;height:14px;border-radius:50%;display:block}
.toggle-row{display:flex;justify-content:space-between;gap:10px;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px;margin-top:8px}
.toggle-row span{font-size:.86rem}
.gift-amt{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.gift-amt button{border:1px solid var(--line);background:#fff;border-radius:999px;padding:8px 12px;font-size:.8rem}
.gift-amt button.active{border-color:rgba(200,121,65,.5);background:var(--brand-soft);color:var(--brand)}
.preview{
  border:1px solid var(--line);background:#fff;border-radius:14px;padding:10px;position:sticky;top:84px;height:max-content
}
.preview-frame{width:100%;height:500px;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#faf5ef}
.preview-frame iframe{width:100%;height:100%;border:none}
.summary{margin-top:10px;border:1px solid var(--line);border-radius:10px;padding:10px;background:#fff}
.summary-row{display:flex;justify-content:space-between;font-size:.82rem;color:#5a4a3f;margin-top:6px}
.summary-row:first-child{margin-top:0}
.summary-row.total{font-weight:700;color:#3a2f2a;border-top:1px dashed var(--line);padding-top:6px}
.nav{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
.nav-right{display:flex;gap:8px}
.toast{
  position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#3a2f2a;color:#fff;padding:10px 14px;
  border-radius:10px;font-size:.82rem;opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:50
}
.toast.show{opacity:1}
@media(max-width:1100px){.wizard-grid{grid-template-columns:1fr}}
@media(max-width:760px){.step-track{grid-template-columns:repeat(3,minmax(0,1fr))}.user-email{display:none}}
</style>
</head>
<body>
<header class="topbar">
  <a href="/" class="logo">Live<span>Card</span> Studio</a>
  <div class="user-actions">
    <span class="user-email" id="userEmail"></span>
    <button class="btn" id="signOutBtn">Sign Out</button>
  </div>
</header>

<main class="page">
  <section class="cardshelf" id="myCardsSection">
    <div class="cardshelf-head">
      <h2>My Cards</h2>
      <span id="cardCount" class="user-email"></span>
    </div>
    <div class="cardshelf-grid" id="shelfGrid"></div>
  </section>

  <section class="wizard">
    <div class="wizard-head">
      <h1>Create A Living Card</h1>
      <p>Follow the full workflow: occasion, photos, message, style, gift, preview.</p>
      <div class="progress"><i id="progressFill"></i></div>
      <div class="step-track" id="stepTrack"></div>
    </div>

    <div class="wizard-grid">
      <div>
        <section class="panel active" data-step="1">
          <h3 class="section-title">1. Choose Your Moment</h3>
          <div class="occasion-grid" id="occasionGrid"></div>
          <div class="field"><label>Recipient Name</label><input id="recipientName" placeholder="Who is this card for?"></div>
          <div class="field"><label>Card Title</label><input id="cardTitle" placeholder="Internal title for your dashboard"></div>
          <div class="field"><label>Your Name</label><input id="senderName" placeholder="Signature name"></div>
        </section>

        <section class="panel" data-step="2">
          <h3 class="section-title">2. Add Your Photos</h3>
          <div class="dropzone" id="dropzone">
            <div style="font-size:1.5rem">ðŸ“·</div>
            <div style="margin-top:6px">Drop memories here or click to upload (max 12)</div>
            <div style="margin-top:4px;color:var(--muted);font-size:.78rem">JPG, PNG, HEIC accepted</div>
            <input type="file" id="fileInput" accept="image/*" multiple hidden>
          </div>
          <div class="photo-list" id="photoList"></div>
        </section>

        <section class="panel" data-step="3">
          <h3 class="section-title">3. Write Your Message</h3>
          <div class="field">
            <label>Main Message</label>
            <textarea id="messageText" placeholder="Write from the heart..."></textarea>
          </div>
          <div class="field">
            <label>AI Assistant (placeholder)</label>
            <button class="btn" id="aiSuggestBtn" type="button">Generate Suggestions</button>
          </div>
          <div class="field">
            <label>Section Messages (optional)</label>
            <div id="sectionMessages"></div>
          </div>
        </section>

        <section class="panel" data-step="4">
          <h3 class="section-title">4. Choose Your Style</h3>
          <div class="field"><label>Theme</label><div class="theme-grid" id="themeGrid"></div></div>
          <div class="field"><label>Music</label><div class="music-grid" id="musicGrid"></div></div>
          <div class="field"><label>Interactive Features</label>
            <div class="toggle-row"><span>Photo interactions</span><input type="checkbox" id="featPhoto" checked></div>
            <div class="toggle-row"><span>Brushstroke reveal</span><input type="checkbox" id="featBrush" checked></div>
            <div class="toggle-row"><span>Paint canvas</span><input type="checkbox" id="featPaint" checked></div>
            <div class="toggle-row"><span>Confetti finale</span><input type="checkbox" id="featConfetti" checked></div>
          </div>
        </section>

        <section class="panel" data-step="5">
          <h3 class="section-title">5. Add A Gift Inside (Optional)</h3>
          <div class="toggle-row"><span>Include gift card</span><input type="checkbox" id="giftEnabled"></div>
          <div class="field"><label>Brand</label><select id="giftBrand"></select></div>
          <div class="field"><label>Amount</label>
            <div class="gift-amt" id="giftAmounts"></div>
            <input id="giftCustom" type="number" min="1" step="1" placeholder="Custom amount (USD)" style="margin-top:8px;display:none">
          </div>
        </section>

        <section class="panel" data-step="6">
          <h3 class="section-title">6. Preview & Finish</h3>
          <p style="margin:0;color:var(--muted)">Open full preview, download HTML, or generate a share link.</p>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn" id="btnOpenPreview" type="button">Open Full Preview</button>
            <button class="btn" id="btnDownload" type="button">Download HTML</button>
            <button class="btn brand" id="btnCopyLink" type="button">Copy Share Link</button>
            <button class="btn" id="btnComplete" type="button">Complete & Send (Beta)</button>
          </div>
        </section>

        <div class="nav">
          <button class="btn" id="btnBack" type="button">Back</button>
          <div class="nav-right">
            <button class="btn" id="btnSaveDraft" type="button">Save Draft</button>
            <button class="btn brand" id="btnNext" type="button">Next</button>
          </div>
        </div>
      </div>

      <aside class="preview">
        <div class="preview-frame" id="previewFrame"></div>
        <div class="summary" id="summaryBox"></div>
      </aside>
    </div>
  </section>
</main>

<div class="toast" id="toast"></div>
<script src="js/dashboard-wizard.js"></script>
</body>
</html>
