<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Living Card For You</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Nunito+Sans:wght@300;400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Nunito Sans',sans-serif;overflow:hidden;width:100vw;height:100vh;touch-action:manipulation;-webkit-font-smoothing:antialiased;background:#E5EDE8}
canvas{position:fixed;inset:0;z-index:0}

.envelope-screen{position:fixed;inset:0;z-index:100;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#E5EDE8;cursor:pointer;transition:opacity 1.4s cubic-bezier(.4,0,.2,1),transform 1.4s cubic-bezier(.4,0,.2,1)}
.envelope-screen.opened{opacity:0;transform:scale(1.15);pointer-events:none}
.env-wrap{position:relative;width:160px;height:130px}
.env-body{width:160px;height:100px;background:linear-gradient(145deg,#fff,#F0EDE5);border-radius:5px;position:absolute;bottom:0;box-shadow:0 10px 50px rgba(58,61,64,.08);border:1px solid rgba(123,165,168,.12)}
.env-flap{width:0;height:0;border-left:80px solid transparent;border-right:80px solid transparent;border-top:65px solid #C0D4D5;position:absolute;top:0;transition:transform 1s cubic-bezier(.4,0,.2,1);transform-origin:top center}
.envelope-screen:hover .env-flap{transform:rotateX(50deg)}
.env-seal{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,#7BA5A8,#E0C8C0);position:absolute;top:38px;left:50%;transform:translateX(-50%);z-index:2;box-shadow:0 3px 15px rgba(123,165,168,.3);display:flex;align-items:center;justify-content:center;font-size:.75rem;color:#F0EDE5;animation:seal 5s ease-in-out infinite}
@keyframes seal{0%,100%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.08)}}
.env-hint{margin-top:2.5rem;font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.05rem;color:#8B9090;opacity:0;animation:fi 2s ease 1s forwards}
.env-from{margin-top:.8rem;font-family:'Cormorant Garamond',serif;font-size:.85rem;letter-spacing:.1em;color:#7BA5A8;opacity:0;animation:fi 2s ease 1.5s forwards}
@keyframes fi{to{opacity:.7}}

.card-exp{position:fixed;inset:0;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;transition:opacity 1.8s ease .6s;pointer-events:none;padding:2rem}
.card-exp.active{opacity:1;pointer-events:auto}

.photo-frame{position:relative;width:min(280px,75vw);height:min(280px,75vw);border-radius:22px;overflow:hidden;cursor:pointer;box-shadow:0 20px 80px rgba(58,61,64,.1);transition:transform .6s cubic-bezier(.4,0,.2,1);margin-bottom:2rem;opacity:0;transform:translateY(25px);animation:rev 1.6s ease 1.8s forwards}
@keyframes rev{to{opacity:1;transform:translateY(0)}}
.photo-frame:hover{transform:scale(1.02)}.photo-frame:active{transform:scale(.98)}
.photo-canvas{width:100%;height:100%;display:block}
.filter-label{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);font-family:'Cormorant Garamond',serif;font-style:italic;font-size:.8rem;color:#fff;background:rgba(58,61,64,.35);backdrop-filter:blur(10px);padding:5px 18px;border-radius:20px;pointer-events:none}
.tap-hint{position:absolute;top:12px;right:12px;font-size:.6rem;color:#fff;background:rgba(58,61,64,.25);backdrop-filter:blur(8px);padding:3px 10px;border-radius:12px;opacity:0;animation:fi 1.5s ease 3.5s forwards}

.msg{text-align:center;max-width:420px;opacity:0;transform:translateY(25px);animation:rev 1.6s ease 2.6s forwards}
.msg-occ{font-size:.65rem;font-weight:600;letter-spacing:.25em;text-transform:uppercase;color:#7BA5A8;margin-bottom:.8rem}
.msg-div{display:block;width:45px;height:1px;background:linear-gradient(to right,transparent,#7BA5A8,transparent);margin:0 auto 1rem}
.msg-txt{font-family:'Cormorant Garamond',serif;font-weight:300;font-size:clamp(1.15rem,3.8vw,1.75rem);line-height:1.65;color:#3A3D40;margin-bottom:1.5rem}
.msg-from{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.05rem;color:#5A8588}

.branding{position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%);z-index:20;font-family:'Cormorant Garamond',serif;font-size:.72rem;color:#8B9090;opacity:0;letter-spacing:.08em;animation:fi 2s ease 4s forwards}
.branding a{color:#7BA5A8;text-decoration:none}
@media(max-height:700px){.photo-frame{width:min(200px,55vw);height:min(200px,55vw)}}
</style>
</head>
<body>
<canvas id="c"></canvas>

<div class="envelope-screen" id="env">
  <div class="env-wrap"><div class="env-flap"></div><div class="env-body"></div><div class="env-seal">~</div></div>
  <p class="env-hint">tap to open</p>
  <p class="env-from">like the tide, I'm always here</p>
</div>

<div class="card-exp" id="exp">
  <div class="photo-frame" id="pf">
    <canvas class="photo-canvas" id="pc"></canvas>
    <div class="filter-label" id="fl">Original</div>
    <div class="tap-hint">tap to transform</div>
  </div>
  <div class="msg">
    <p class="msg-occ">Just Because</p>
    <span class="msg-div"></span>
    <p class="msg-txt">Some things don't need a reason. I just wanted you to know — the world is steadier because you're in it.</p>
    <p class="msg-from">— always, quietly, yours</p>
  </div>
</div>
<div class="branding">made with <a href="#">LiveCardStudio</a> — cards that breathe</div>

<script>
// PERLIN
const P=new Uint8Array(512),G=[];
(function(){const p=[];for(let i=0;i<256;i++)p[i]=i;for(let i=255;i>0;i--){const j=Math.floor(Math.random()*(i+1));[p[i],p[j]]=[p[j],p[i]];}for(let i=0;i<512;i++)P[i]=p[i&255];for(let i=0;i<256;i++){const a=Math.random()*Math.PI*2;G[i]=[Math.cos(a),Math.sin(a)];}})();
function fade(t){return t*t*t*(t*(t*6-15)+10)}function lerp(a,b,t){return a+(b-a)*t}function dot2(g,x,y){return g[0]*x+g[1]*y}
function noise2D(x,y){const X=Math.floor(x)&255,Y=Math.floor(y)&255,xf=x-Math.floor(x),yf=y-Math.floor(y),u=fade(xf),v=fade(yf);const aa=P[P[X]+Y],ab=P[P[X]+Y+1],ba=P[P[X+1]+Y],bb=P[P[X+1]+Y+1];return lerp(lerp(dot2(G[aa],xf,yf),dot2(G[ba],xf-1,yf),u),lerp(dot2(G[ab],xf,yf-1),dot2(G[bb],xf-1,yf-1),u),v)}
function fbm(x,y,oct=4){let v=0,a=.5,f=1;for(let i=0;i<oct;i++){v+=a*noise2D(x*f,y*f);a*=.5;f*=2;}return v}

const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
let W,H,t=0,mx=0,my=0,mxS=0,myS=0;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight}
resize();addEventListener('resize',resize);
addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY});
addEventListener('touchmove',e=>{mx=e.touches[0].clientX;my=e.touches[0].clientY},{passive:true});

// ═══ LAYER 1: Sky gradient washes ═══
class SkyWash{
  constructor(){
    this.x=Math.random()*W;this.y=Math.random()*H*.55;
    this.baseR=130+Math.random()*250;
    this.hue=[185,195,210,170,25,200][Math.floor(Math.random()*6)];
    this.sat=14+Math.random()*20;this.light=88+Math.random()*8;
    this.alpha=.06+Math.random()*.09;this.phase=Math.random()*Math.PI*2;
    this.speed=.0002+Math.random()*.0003;this.nOff=Math.random()*100;
  }
  draw(t){
    const n=fbm(this.nOff+t*.00004,this.nOff+t*.00003);
    const breathe=(Math.sin(t*this.speed+this.phase)+n*.4)*.15+1;
    const r=this.baseR*breathe;
    const x=this.x+noise2D(this.nOff+t*.00006,0)*40;
    const y=this.y+noise2D(0,this.nOff+t*.00004)*30;
    const hS=noise2D(t*.0001,this.nOff)*6;
    const g=ctx.createRadialGradient(x,y,0,x,y,r);
    g.addColorStop(0,`hsla(${this.hue+hS},${this.sat}%,${this.light}%,${this.alpha})`);
    g.addColorStop(.5,`hsla(${this.hue+hS},${this.sat-2}%,${this.light+1}%,${this.alpha*.4})`);
    g.addColorStop(1,`hsla(${this.hue},${this.sat}%,${this.light}%,0)`);
    ctx.fillStyle=g;ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fill();
  }
}

// ═══ LAYER 2: Ocean waves (8 depth layers) ═══
class WaveLayer{
  constructor(yFrac,amp,freq,speed,hue,sat,light,alpha,depth){
    this.yFrac=yFrac;this.amp=amp;this.freq=freq;this.speed=speed;
    this.hue=hue;this.sat=sat;this.light=light;this.alpha=alpha;
    this.depth=depth;this.phase=Math.random()*Math.PI*2;
    this.nOff=Math.random()*100;
  }
  getY(x,t){
    const base=this.yFrac*H;
    const breathe=Math.sin(t*.0006+this.phase)*this.amp*.4;
    const n1=noise2D(x*.002+t*this.speed*.3+this.nOff,this.nOff)*this.amp*.7;
    const w1=Math.sin(x*this.freq+t*this.speed+this.phase)*this.amp;
    const w2=Math.sin(x*this.freq*.6+t*this.speed*.7+this.phase*1.3)*this.amp*.5;
    const w3=Math.sin(x*this.freq*2.2+t*this.speed*1.4)*this.amp*.15;
    return base+breathe+n1+w1+w2+w3;
  }
  draw(t){
    const hS=noise2D(t*.0001+this.nOff,this.nOff)*5;
    ctx.beginPath();ctx.moveTo(0,H);
    for(let x=0;x<=W;x+=2){ctx.lineTo(x,this.getY(x,t));}
    ctx.lineTo(W,H);ctx.closePath();
    
    // Gradient fill
    const topY=this.yFrac*H-this.amp*2;
    const g=ctx.createLinearGradient(0,topY,0,topY+this.amp*6);
    g.addColorStop(0,`hsla(${this.hue+hS},${this.sat}%,${this.light}%,${this.alpha})`);
    g.addColorStop(.3,`hsla(${this.hue+hS+2},${this.sat-1}%,${this.light-2}%,${this.alpha*.85})`);
    g.addColorStop(1,`hsla(${this.hue+hS},${this.sat-3}%,${this.light-4}%,${this.alpha*.6})`);
    ctx.fillStyle=g;ctx.fill();
  }
}

// ═══ LAYER 3: Foam system ═══
class FoamParticle{
  constructor(init){this.reset(init);}
  reset(init){
    this.x=Math.random()*W;
    this.y=init?H*.52+Math.random()*H*.38:H*.52+Math.random()*H*.35;
    this.size=.5+Math.random()*2.5;this.alpha=.08+Math.random()*.18;
    this.life=150+Math.random()*400;this.age=init?Math.random()*this.life:0;
    this.nOff=Math.random()*200;this.phase=Math.random()*Math.PI*2;
    this.cluster=Math.random()<.2;// foam clusters
    if(this.cluster){this.size*=1.5;this.alpha*=.7;}
  }
  update(t){
    this.age++;
    const n=noise2D(this.nOff+t*.0003,this.y*.005);
    this.x+=n*.3+(Math.random()-.5)*.1;
    this.y+=Math.sin(t*.001+this.phase)*.08-.01;
    if(this.age>this.life)this.reset(false);
  }
  draw(t){
    const fadeIn=Math.min(1,this.age/25);
    const fadeOut=this.age>this.life-40?Math.max(0,1-(this.age-(this.life-40))/40):1;
    const a=this.alpha*fadeIn*fadeOut;
    if(a<=0)return;
    
    ctx.globalAlpha=a;
    if(this.cluster){
      // Foam cluster = multiple small circles
      for(let i=0;i<4;i++){
        const ox=(Math.random()-.5)*this.size*2,oy=(Math.random()-.5)*this.size;
        ctx.fillStyle='rgba(255,255,255,.8)';
        ctx.beginPath();ctx.arc(this.x+ox,this.y+oy,this.size*.4+Math.random()*.3,0,Math.PI*2);ctx.fill();
      }
    }else{
      ctx.fillStyle='#fff';
      ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();
    }
    ctx.globalAlpha=1;
  }
}

// ═══ LAYER 4: Light motes (underwater glow) ═══
class LightMote{
  constructor(init){this.reset(init);}
  reset(init){
    this.x=Math.random()*W;
    this.y=init?H*.3+Math.random()*H*.5:H*.65+Math.random()*H*.25;
    this.size=1+Math.random()*2;this.speedY=-(0.03+Math.random()*.08);
    this.alpha=.06+Math.random()*.12;this.phase=Math.random()*Math.PI*2;
    this.twinkle=.004+Math.random()*.008;this.nOff=Math.random()*200;
    this.hue=180+Math.random()*30;
    this.bioluminescent=Math.random()<.04;// rare bio glow
    if(this.bioluminescent){this.alpha*=2;this.size*=1.5;this.hue=170;}
  }
  update(t){
    this.y+=this.speedY;
    this.x+=noise2D(this.nOff+t*.0002,this.y*.008)*.15;
    if(this.y<H*.15)this.reset(false);
  }
  draw(t){
    const glow=.4+Math.sin(t*this.twinkle+this.phase)*.6;
    ctx.globalAlpha=this.alpha*glow;
    
    // Outer glow
    const g=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.size*5);
    g.addColorStop(0,`hsla(${this.hue},30%,75%,.2)`);
    g.addColorStop(.4,`hsla(${this.hue},25%,78%,.05)`);
    g.addColorStop(1,`hsla(${this.hue},20%,80%,0)`);
    ctx.fillStyle=g;ctx.beginPath();ctx.arc(this.x,this.y,this.size*5,0,Math.PI*2);ctx.fill();
    
    // Core
    ctx.fillStyle=`hsla(${this.hue},25%,88%,.8)`;
    ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();
    
    // Bioluminescent pulse
    if(this.bioluminescent&&glow>.7){
      ctx.globalAlpha=(glow-.7)*3*this.alpha*.3;
      const ring=ctx.createRadialGradient(this.x,this.y,this.size*2,this.x,this.y,this.size*10);
      ring.addColorStop(0,`hsla(170,40%,65%,.2)`);ring.addColorStop(1,`hsla(170,40%,65%,0)`);
      ctx.fillStyle=ring;ctx.beginPath();ctx.arc(this.x,this.y,this.size*10,0,Math.PI*2);ctx.fill();
    }
    
    ctx.globalAlpha=1;
  }
}

// ═══ LAYER 5: Coastal mist ═══
function drawMist(t){
  ctx.save();
  for(let i=0;i<3;i++){
    const y=H*(.48+i*.06)+noise2D(t*.00005+i*10,i)*15;
    const breathe=Math.sin(t*.0003+i*2)*.3+.7;
    const g=ctx.createLinearGradient(0,y-40,0,y+40);
    g.addColorStop(0,'rgba(229,237,232,0)');
    g.addColorStop(.5,`rgba(229,237,232,${.03*breathe})`);
    g.addColorStop(1,'rgba(229,237,232,0)');
    ctx.fillStyle=g;
    
    // Noise-shaped mist
    ctx.beginPath();
    for(let x=0;x<=W;x+=3){
      const n=fbm(x*.003+t*.00004+i*5,i*10,3)*25;
      const my=y+n;
      x===0?ctx.moveTo(x,my-40):ctx.lineTo(x,my-40);
    }
    for(let x=W;x>=0;x-=3){
      const n=fbm(x*.003+t*.00004+i*5,i*10+1,3)*25;
      ctx.lineTo(x,y+n+40);
    }
    ctx.closePath();ctx.fill();
  }
  ctx.restore();
}

// ═══ LAYER 6: Light shafts through water ═══
function drawLightShafts(t){
  ctx.save();ctx.globalCompositeOperation='screen';
  const breathe=Math.sin(t*.0003)*.4+.6;
  for(let i=0;i<3;i++){
    const x=W*(.25+i*.25)+Math.sin(t*.0002+i*3)*30;
    const angle=.08+i*.06+Math.sin(t*.00015+i)*.04;
    const width=40+Math.sin(t*.0004+i*2)*15;
    const n=noise2D(t*.0001+i*10,i)*.3;
    
    ctx.globalAlpha=(.008+n*.005)*breathe;
    ctx.save();ctx.translate(x,H*.45);ctx.rotate(angle);
    
    const g=ctx.createLinearGradient(-width,0,width,0);
    g.addColorStop(0,'rgba(180,210,210,0)');
    g.addColorStop(.3,'rgba(200,225,220,.3)');
    g.addColorStop(.5,'rgba(220,240,235,.5)');
    g.addColorStop(.7,'rgba(200,225,220,.3)');
    g.addColorStop(1,'rgba(180,210,210,0)');
    ctx.fillStyle=g;ctx.fillRect(-width,-10,width*2,H*.5);
    
    ctx.restore();
  }
  ctx.restore();
}

// ═══ LAYER 7: Micro sea particles ═══
class SeaDust{
  constructor(){
    this.x=Math.random()*W;this.y=Math.random()*H;
    this.size=.3+Math.random()*.6;this.alpha=.04+Math.random()*.06;
    this.nOff=Math.random()*200;this.phase=Math.random()*Math.PI*2;
    this.twinkle=.003+Math.random()*.005;
  }
  update(t){
    const n=noise2D(this.nOff+t*.0001,this.y*.008);
    this.x+=Math.cos(n*Math.PI*2)*.05;this.y+=Math.sin(n*Math.PI)*.04;
    if(this.x<0)this.x=W;if(this.x>W)this.x=0;if(this.y<0)this.y=H;if(this.y>H)this.y=0;
  }
  draw(t){
    const tw=.3+Math.sin(t*this.twinkle+this.phase)*.7;
    ctx.globalAlpha=this.alpha*tw;
    ctx.fillStyle='rgba(200,220,215,.7)';
    ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();
    ctx.globalAlpha=1;
  }
}

// ═══ INIT ═══
const skyWashes=Array.from({length:6},()=>new SkyWash());
const waves=[
  new WaveLayer(.53,14,.003,.0006,190,28,80,.22,0),
  new WaveLayer(.56,12,.0035,.0008,188,25,82,.2,1),
  new WaveLayer(.59,10,.004,.001,186,22,84,.18,2),
  new WaveLayer(.62,8,.0045,.0012,190,20,86,.16,3),
  new WaveLayer(.66,7,.005,.0015,185,18,88,.14,4),
  new WaveLayer(.70,5,.006,.0018,192,16,90,.12,5),
  new WaveLayer(.74,4,.007,.002,188,14,91,.1,6),
  new WaveLayer(.78,3,.008,.0025,185,12,92,.08,7),
];
const foams=Array.from({length:40},()=>new FoamParticle(true));
const motes=Array.from({length:20},()=>new LightMote(true));
const seaDust=Array.from({length:60},()=>new SeaDust());
const touchFoam=[];

// ═══ RENDER ═══
function render(){
  t++;mxS+=(mx-mxS)*.03;myS+=(my-myS)*.03;
  
  // Sky to water gradient base
  const skyG=ctx.createLinearGradient(0,0,0,H);
  skyG.addColorStop(0,'rgba(229,237,232,.94)');
  skyG.addColorStop(.45,'rgba(220,232,228,.94)');
  skyG.addColorStop(1,'rgba(200,218,215,.94)');
  ctx.fillStyle=skyG;ctx.fillRect(0,0,W,H);
  
  if(t%4===0){for(let i=0;i<60;i++){ctx.fillStyle=`rgba(139,144,144,${Math.random()*.004})`;ctx.fillRect(Math.random()*W,Math.random()*H,1,1);}}
  
  skyWashes.forEach(w=>w.draw(t));
  drawMist(t);
  
  // Waves: far first
  waves.slice(0,4).forEach(w=>w.draw(t));
  drawLightShafts(t);
  waves.slice(4).forEach(w=>w.draw(t));
  
  // Foam on wave crests
  foams.forEach(f=>{f.update(t);f.draw(t);});
  
  motes.forEach(m=>{m.update(t);m.draw(t);});
  seaDust.forEach(d=>{d.update(t);d.draw(t);});
  
  touchFoam.forEach(f=>{f.update(t);f.draw(t);});
  for(let i=touchFoam.length-1;i>=0;i--){if(touchFoam[i].age>touchFoam[i].life)touchFoam.splice(i,1);}
  
  requestAnimationFrame(render);
}
render();

// ═══ ENVELOPE + PHOTO ═══
document.getElementById('env').addEventListener('click',function(){this.classList.add('opened');setTimeout(()=>{document.getElementById('exp').classList.add('active');this.style.display='none';},700)});

const pc=document.getElementById('pc'),pctx=pc.getContext('2d'),fl=document.getElementById('fl');
const FILTERS=['Original','Coastal','Sea Glass','Driftwood','Tidal'];
let cf=0,origData;

function genPhoto(w,h){
  const o=document.createElement('canvas');o.width=w;o.height=h;const c=o.getContext('2d');
  const bg=c.createLinearGradient(0,0,w,h);bg.addColorStop(0,'#B8CDD0');bg.addColorStop(.3,'#A0B8BC');bg.addColorStop(.6,'#C8D0C8');bg.addColorStop(1,'#E0C8C0');
  c.fillStyle=bg;c.fillRect(0,0,w,h);
  for(let i=0;i<12;i++){const x=w*.15+Math.random()*w*.7,y=h*.15+Math.random()*h*.7,r=25+Math.random()*60;const g=c.createRadialGradient(x,y,0,x,y,r);g.addColorStop(0,`hsla(${[185,195,20,170][Math.floor(Math.random()*4)]},25%,75%,.4)`);g.addColorStop(1,`hsla(185,25%,75%,0)`);c.fillStyle=g;c.beginPath();c.arc(x,y,r,0,Math.PI*2);c.fill();}
  for(let i=0;i<3500;i++){c.fillStyle=`rgba(255,255,255,${Math.random()*.04})`;c.fillRect(Math.random()*w,Math.random()*h,1,1);}
  c.font='300 15px "Cormorant Garamond",serif';c.textAlign='center';c.fillStyle='rgba(58,61,64,.3)';
  c.fillText('your photo here',w/2,h*.83);c.font='300 10px "Nunito Sans",sans-serif';c.fillText('(tap to see art filters)',w/2,h*.89);
  return o;
}

function initPhoto(){const f=document.getElementById('pf');const s=f.offsetWidth||280;pc.width=s;pc.height=s;pctx.drawImage(genPhoto(s,s),0,0);origData=pctx.getImageData(0,0,s,s);}

function applyFilter(n){
  const w=pc.width,h=pc.height;pctx.putImageData(origData,0,0);if(n==='Original')return;
  const id=pctx.getImageData(0,0,w,h),d=id.data;
  if(n==='Coastal'){for(let i=0;i<d.length;i+=4){d[i]=Math.min(255,d[i]*.92+8);d[i+1]=Math.min(255,d[i+1]*1.02+5);d[i+2]=Math.min(255,d[i+2]*1.08+8);}pctx.putImageData(id,0,0);pctx.globalAlpha=.15;for(let i=0;i<5;i++)pctx.drawImage(pc,(Math.random()-.5)*4,(Math.random()-.5)*4);pctx.globalAlpha=1;}
  else if(n==='Sea Glass'){for(let i=0;i<d.length;i+=4){const avg=(d[i]+d[i+1]+d[i+2])/3;d[i]=Math.min(255,avg*.9+15);d[i+1]=Math.min(255,avg+20);d[i+2]=Math.min(255,avg*1.05+22);d[i+3]=220;}pctx.putImageData(id,0,0);const v=pctx.createRadialGradient(w/2,h/2,w*.15,w/2,h/2,w*.55);v.addColorStop(0,'rgba(232,240,237,0)');v.addColorStop(1,'rgba(184,205,208,.2)');pctx.fillStyle=v;pctx.fillRect(0,0,w,h);}
  else if(n==='Driftwood'){for(let i=0;i<d.length;i+=4){const gray=d[i]*.3+d[i+1]*.59+d[i+2]*.11;d[i]=Math.min(255,gray*1.05+15);d[i+1]=Math.min(255,gray+12);d[i+2]=Math.min(255,gray*.95+8);}pctx.putImageData(id,0,0);pctx.fillStyle='rgba(245,240,234,.2)';pctx.fillRect(0,0,w,h);for(let i=0;i<2000;i++){const x=Math.random()*w,y=Math.random()*h,len=4+Math.random()*12;pctx.strokeStyle=`rgba(184,168,152,${.02+Math.random()*.03})`;pctx.lineWidth=.5;pctx.beginPath();pctx.moveTo(x,y);pctx.lineTo(x+len,y+(Math.random()-.5)*2);pctx.stroke();}}
  else if(n==='Tidal'){for(let i=0;i<d.length;i+=4){d[i]=Math.min(255,d[i]*.95+10);d[i+1]=Math.min(255,d[i+1]*1.03+8);d[i+2]=Math.min(255,d[i+2]*1.06+12);}pctx.putImageData(id,0,0);pctx.globalAlpha=.2;for(let i=0;i<6;i++)pctx.drawImage(pc,(Math.random()-.5)*5,(Math.random()-.5)*5);pctx.globalAlpha=1;for(let i=0;i<10;i++){const y2=h*.2+Math.random()*h*.6;pctx.strokeStyle=`rgba(200,220,215,${.03+Math.random()*.04})`;pctx.lineWidth=1;pctx.beginPath();for(let x=0;x<w;x+=2){const yy=y2+Math.sin(x*.02+i)*8;x===0?pctx.moveTo(x,yy):pctx.lineTo(x,yy);}pctx.stroke();}}
}

document.getElementById('pf').addEventListener('click',e=>{
  cf=(cf+1)%FILTERS.length;pc.style.transition='opacity .3s';pc.style.opacity='.4';
  setTimeout(()=>{applyFilter(FILTERS[cf]);fl.textContent=FILTERS[cf];pc.style.opacity='1';},250);
  for(let i=0;i<4;i++){const f=new FoamParticle(false);f.x=e.clientX+(Math.random()-.5)*60;f.y=e.clientY;f.alpha=.2+Math.random()*.2;touchFoam.push(f);}
  for(let i=0;i<3;i++){const m=new LightMote(false);m.x=e.clientX+(Math.random()-.5)*50;m.y=e.clientY;m.alpha=.15+Math.random()*.1;motes.push(m);setTimeout(()=>{const idx=motes.indexOf(m);if(idx>-1)motes.splice(idx,1);},12000);}
});

document.addEventListener('click',e=>{
  if(e.target.closest('.envelope-screen')||e.target.closest('.photo-frame'))return;
  for(let i=0;i<5;i++){const f=new FoamParticle(false);f.x=e.clientX+(Math.random()-.5)*50;f.y=e.clientY+(Math.random()-.5)*30;f.alpha=.2+Math.random()*.15;touchFoam.push(f);}
  for(let i=0;i<2;i++){const m=new LightMote(false);m.x=e.clientX+(Math.random()-.5)*40;m.y=e.clientY;m.alpha=.12+Math.random()*.1;motes.push(m);setTimeout(()=>{const idx=motes.indexOf(m);if(idx>-1)motes.splice(idx,1);},10000);}
});

document.fonts.ready.then(()=>setTimeout(initPhoto,100));
addEventListener('resize',()=>{resize();waves.forEach((w,i)=>{w.yFrac=.53+i*.035;});setTimeout(initPhoto,100);});
</script>
</body>
</html>
