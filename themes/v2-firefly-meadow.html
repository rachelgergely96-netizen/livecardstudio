<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>A Living Card For You</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Nunito+Sans:wght@300;400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Nunito Sans',sans-serif;overflow:hidden;width:100vw;height:100vh;touch-action:manipulation;-webkit-font-smoothing:antialiased;background:#1A1E2E}canvas{position:fixed;inset:0;z-index:0}
.envelope-screen{position:fixed;inset:0;z-index:100;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#1A1E2E;cursor:pointer;transition:opacity 1.4s cubic-bezier(.4,0,.2,1),transform 1.4s cubic-bezier(.4,0,.2,1)}.envelope-screen.opened{opacity:0;transform:scale(1.15);pointer-events:none}
.env-wrap{position:relative;width:160px;height:130px}.env-body{width:160px;height:100px;background:linear-gradient(145deg,#2A2E3E,#222638);border-radius:5px;position:absolute;bottom:0;box-shadow:0 10px 50px rgba(0,0,0,.3);border:1px solid rgba(180,200,140,.06)}.env-flap{width:0;height:0;border-left:80px solid transparent;border-right:80px solid transparent;border-top:65px solid #333850;position:absolute;top:0;transition:transform 1s cubic-bezier(.4,0,.2,1);transform-origin:top center}.envelope-screen:hover .env-flap{transform:rotateX(50deg)}
.env-seal{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,#C8D88C,#A4B86C);position:absolute;top:38px;left:50%;transform:translateX(-50%);z-index:2;box-shadow:0 3px 20px rgba(164,184,108,.35);display:flex;align-items:center;justify-content:center;font-size:.7rem;color:#1A1E2E;animation:seal 4s ease-in-out infinite}@keyframes seal{0%,100%{transform:translateX(-50%) scale(1);box-shadow:0 3px 20px rgba(164,184,108,.35)}50%{transform:translateX(-50%) scale(1.1);box-shadow:0 5px 35px rgba(164,184,108,.55)}}
.env-hint{margin-top:2.5rem;font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.05rem;color:#8B9B7B;opacity:0;animation:fi 2s ease 1s forwards}.env-from{margin-top:.8rem;font-family:'Cormorant Garamond',serif;font-size:.85rem;letter-spacing:.1em;color:#B8C888;opacity:0;animation:fi 2s ease 1.5s forwards}@keyframes fi{to{opacity:.7}}
.card-exp{position:fixed;inset:0;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;transition:opacity 1.8s ease .6s;pointer-events:none;padding:2rem}.card-exp.active{opacity:1;pointer-events:auto}
.photo-frame{position:relative;width:min(280px,75vw);height:min(280px,75vw);border-radius:22px;overflow:hidden;cursor:pointer;box-shadow:0 20px 80px rgba(0,0,0,.25),0 0 40px rgba(164,184,108,.04);transition:transform .6s;margin-bottom:2rem;opacity:0;transform:translateY(25px);animation:rev 1.6s ease 1.8s forwards}@keyframes rev{to{opacity:1;transform:translateY(0)}}.photo-frame:hover{transform:scale(1.02)}.photo-canvas{width:100%;height:100%;display:block}
.filter-label{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);font-family:'Cormorant Garamond',serif;font-style:italic;font-size:.8rem;color:#E0E8D0;background:rgba(26,30,46,.5);backdrop-filter:blur(10px);padding:5px 18px;border-radius:20px;pointer-events:none}.tap-hint{position:absolute;top:12px;right:12px;font-size:.6rem;color:#E0E8D0;background:rgba(26,30,46,.4);backdrop-filter:blur(8px);padding:3px 10px;border-radius:12px;opacity:0;animation:fi 1.5s ease 3.5s forwards}
.msg{text-align:center;max-width:420px;opacity:0;transform:translateY(25px);animation:rev 1.6s ease 2.6s forwards}.msg-occ{font-size:.65rem;font-weight:600;letter-spacing:.25em;text-transform:uppercase;color:#B8C888;margin-bottom:.8rem}.msg-div{display:block;width:45px;height:1px;background:linear-gradient(to right,transparent,#B8C888,transparent);margin:0 auto 1rem}.msg-txt{font-family:'Cormorant Garamond',serif;font-weight:300;font-size:clamp(1.15rem,3.8vw,1.75rem);line-height:1.65;color:#E0E8D0;margin-bottom:1.5rem}.msg-from{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.05rem;color:#A4B86C}
.branding{position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%);z-index:20;font-family:'Cormorant Garamond',serif;font-size:.72rem;color:rgba(164,184,108,.3);opacity:0;letter-spacing:.08em;animation:fi 2s ease 4s forwards}.branding a{color:#B8C888;text-decoration:none}
@media(max-height:700px){.photo-frame{width:min(200px,55vw);height:min(200px,55vw)}}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="envelope-screen" id="env"><div class="env-wrap"><div class="env-flap"></div><div class="env-body"></div><div class="env-seal">✧</div></div><p class="env-hint">tap to open</p><p class="env-from">meet me in the meadow at dusk</p></div>
<div class="card-exp" id="exp"><div class="photo-frame" id="pf"><canvas class="photo-canvas" id="pc"></canvas><div class="filter-label" id="fl">Original</div><div class="tap-hint">tap to transform</div></div><div class="msg"><p class="msg-occ">Congratulations</p><span class="msg-div"></span><p class="msg-txt">Some moments are so bright they light up the whole field. This is yours. Stand in it. Let it glow around you.</p><p class="msg-from">— cheering from the tall grass</p></div></div>
<div class="branding">made with <a href="#">LiveCardStudio</a> — cards that breathe</div>
<script>
const P=new Uint8Array(512),G=[];(function(){const p=[];for(let i=0;i<256;i++)p[i]=i;for(let i=255;i>0;i--){const j=Math.floor(Math.random()*(i+1));[p[i],p[j]]=[p[j],p[i]];}for(let i=0;i<512;i++)P[i]=p[i&255];for(let i=0;i<256;i++){const a=Math.random()*Math.PI*2;G[i]=[Math.cos(a),Math.sin(a)];}})();
function fade(t){return t*t*t*(t*(t*6-15)+10)}function lerp(a,b,t){return a+(b-a)*t}function dot2(g,x,y){return g[0]*x+g[1]*y}
function noise2D(x,y){const X=Math.floor(x)&255,Y=Math.floor(y)&255,xf=x-Math.floor(x),yf=y-Math.floor(y),u=fade(xf),v=fade(yf);return lerp(lerp(dot2(G[P[P[X]+Y]],xf,yf),dot2(G[P[P[X+1]+Y]],xf-1,yf),u),lerp(dot2(G[P[P[X]+Y+1]],xf,yf-1),dot2(G[P[P[X+1]+Y+1]],xf-1,yf-1),u),v)}
function fbm(x,y,o=4){let v=0,a=.5,f=1;for(let i=0;i<o;i++){v+=a*noise2D(x*f,y*f);a*=.5;f*=2;}return v}

const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');let W,H,t=0,mx=0,my=0,mxS=0,myS=0;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight}resize();addEventListener('resize',resize);
addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY});addEventListener('touchmove',e=>{mx=e.touches[0].clientX;my=e.touches[0].clientY},{passive:true});

// ═══ TWILIGHT SKY ═══
function drawSky(t){
  const breathe=Math.sin(t*.0002)*.03;
  const g=ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,`hsl(225,30%,${12+breathe*100}%)`);
  g.addColorStop(.25,'hsl(230,25%,18%)');
  g.addColorStop(.5,'hsl(245,20%,22%)');
  g.addColorStop(.7,'hsl(270,18%,28%)');
  g.addColorStop(.85,'hsl(20,35%,35%)');
  g.addColorStop(.95,'hsl(30,45%,40%)');
  g.addColorStop(1,'hsl(25,50%,32%)');
  ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
}

// ═══ STARS ═══
class TwilightStar{
  constructor(){this.x=Math.random()*W;this.y=Math.random()*H*.55;this.sz=.3+Math.random()*1.2;this.al=.1+Math.random()*.3;this.twSp=.003+Math.random()*.006;this.ph=Math.random()*Math.PI*2;this.h=210+Math.random()*40}
  draw(t){const tw=.3+Math.sin(t*this.twSp+this.ph)*.7;ctx.globalAlpha=this.al*tw;ctx.fillStyle=`hsla(${this.h},20%,85%,1)`;ctx.beginPath();ctx.arc(this.x,this.y,this.sz,0,Math.PI*2);ctx.fill();if(this.sz>1&&tw>.7){ctx.strokeStyle=`hsla(${this.h},20%,85%,${this.al*.15})`;ctx.lineWidth=.3;const l=this.sz*3*tw;ctx.beginPath();ctx.moveTo(this.x-l,this.y);ctx.lineTo(this.x+l,this.y);ctx.moveTo(this.x,this.y-l);ctx.lineTo(this.x,this.y+l);ctx.stroke()}ctx.globalAlpha=1}
}

// ═══ FIREFLIES ═══
class Firefly{
  constructor(){
    this.x=Math.random()*W;this.y=H*.35+Math.random()*H*.45;
    this.targetX=this.x;this.targetY=this.y;
    this.sz=1.5+Math.random()*2;
    this.no=Math.random()*200;
    this.speed=.2+Math.random()*.4;
    // Blink cycle - each firefly has its own rhythm
    this.blinkPh=Math.random()*Math.PI*2;
    this.blinkSp=.015+Math.random()*.025;
    this.blinkPattern=Math.floor(Math.random()*3); // 0=slow pulse, 1=double blink, 2=flutter
    this.trail=[];
    this.maxTrail=12+Math.floor(Math.random()*8);
    this.hue=55+Math.random()*25; // yellow-green range
    this.sat=60+Math.random()*20;
  }
  getBlinkIntensity(t){
    const phase=(t*this.blinkSp+this.blinkPh)%(Math.PI*2);
    if(this.blinkPattern===0)return Math.max(0,Math.sin(phase));
    if(this.blinkPattern===1){const v=Math.sin(phase);return v>0?Math.pow(v,2):0;} // sharp on/off
    // Flutter: rapid blink
    const base=Math.sin(phase);
    return base>0?base*(.5+Math.sin(t*.08+this.no)*.5):0;
  }
  update(t){
    // Wander toward target
    const dx=this.targetX-this.x,dy=this.targetY-this.y;
    const dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<15){
      this.targetX=Math.max(20,Math.min(W-20,this.x+(Math.random()-.5)*200));
      this.targetY=Math.max(H*.3,Math.min(H*.85,this.y+(Math.random()-.5)*120));
    }
    
    const nfx=noise2D(this.no+t*.0003,this.y*.003)*.4;
    const nfy=noise2D(this.y*.003,this.no+t*.0002)*.3;
    this.x+=dx/(dist||1)*this.speed+nfx;
    this.y+=dy/(dist||1)*this.speed+nfy;
    
    // Trail
    this.trail.push({x:this.x,y:this.y});
    if(this.trail.length>this.maxTrail)this.trail.shift();
    
    // Mouse attraction (subtle)
    const mdx=mxS-this.x,mdy=myS-this.y;
    const md=Math.sqrt(mdx*mdx+mdy*mdy);
    if(md<200){this.x+=mdx*.001;this.y+=mdy*.001;}
  }
  draw(t){
    const intensity=this.getBlinkIntensity(t);
    if(intensity<.01)return;
    
    ctx.save();
    
    // Trail glow
    for(let i=1;i<this.trail.length;i++){
      const p=this.trail[i];
      const trailAlpha=intensity*(i/this.trail.length)*.06;
      ctx.fillStyle=`hsla(${this.hue},${this.sat}%,65%,${trailAlpha})`;
      ctx.beginPath();ctx.arc(p.x,p.y,this.sz*.6,0,Math.PI*2);ctx.fill();
    }
    
    // Outer haze
    const outerR=this.sz*15*intensity;
    const g1=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,outerR);
    g1.addColorStop(0,`hsla(${this.hue},${this.sat}%,60%,${.06*intensity})`);
    g1.addColorStop(.4,`hsla(${this.hue},${this.sat-10}%,55%,${.02*intensity})`);
    g1.addColorStop(1,`hsla(${this.hue},${this.sat}%,55%,0)`);
    ctx.fillStyle=g1;ctx.beginPath();ctx.arc(this.x,this.y,outerR,0,Math.PI*2);ctx.fill();
    
    // Inner glow
    const innerR=this.sz*5*intensity;
    const g2=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,innerR);
    g2.addColorStop(0,`hsla(${this.hue-5},${this.sat+10}%,75%,${.3*intensity})`);
    g2.addColorStop(.5,`hsla(${this.hue},${this.sat}%,65%,${.1*intensity})`);
    g2.addColorStop(1,`hsla(${this.hue},${this.sat}%,60%,0)`);
    ctx.fillStyle=g2;ctx.beginPath();ctx.arc(this.x,this.y,innerR,0,Math.PI*2);ctx.fill();
    
    // Core
    ctx.globalAlpha=intensity;
    ctx.fillStyle=`hsla(${this.hue-10},${this.sat+15}%,88%,1)`;
    ctx.beginPath();ctx.arc(this.x,this.y,this.sz*.5,0,Math.PI*2);ctx.fill();
    
    // Hot center
    ctx.fillStyle=`rgba(255,255,240,${.7*intensity})`;
    ctx.beginPath();ctx.arc(this.x,this.y,this.sz*.2,0,Math.PI*2);ctx.fill();
    
    ctx.restore();
  }
}

// ═══ GRASS SILHOUETTES ═══
function drawGrass(t){
  const grassLine=H*.78;
  
  // Far grass (darker, less detail)
  ctx.save();ctx.globalAlpha=.15;
  for(let x=0;x<W;x+=6){
    const wind=noise2D(x*.003+t*.0002,t*.0001)*10;
    const h=20+noise2D(x*.008,0)*25;
    const sway=noise2D(x*.005+t*.0003,0)*8+wind;
    ctx.strokeStyle='hsl(100,15%,12%)';ctx.lineWidth=1.2;
    ctx.beginPath();ctx.moveTo(x,grassLine+5);
    ctx.quadraticCurveTo(x+sway*.3,grassLine-h*.5+sway*.4,x+sway,grassLine-h);
    ctx.stroke();
  }
  ctx.restore();
  
  // Near grass (foreground detail)
  ctx.save();ctx.globalAlpha=.35;
  for(let x=0;x<W;x+=3){
    const wind=noise2D(x*.004+t*.0003,t*.00015)*12;
    const h=30+noise2D(x*.006,1)*40;
    const sway=noise2D(x*.004+t*.0004,1)*10+wind;
    const thickness=.5+noise2D(x*.01,2)*.8;
    
    ctx.strokeStyle=`hsl(${95+noise2D(x*.01,0)*15},12%,${8+noise2D(x*.02,0)*5}%)`;
    ctx.lineWidth=thickness;
    ctx.beginPath();ctx.moveTo(x,grassLine+15);
    ctx.bezierCurveTo(x+sway*.2,grassLine-h*.3,x+sway*.6,grassLine-h*.6+sway*.3,x+sway,grassLine-h);
    ctx.stroke();
    
    // Occasional seed head
    if(Math.random()<.03&&h>40){
      ctx.fillStyle=`hsla(40,20%,25%,${.15+Math.random()*.1})`;
      ctx.beginPath();ctx.arc(x+sway,grassLine-h,1+Math.random(),0,Math.PI*2);ctx.fill();
    }
  }
  ctx.restore();
  
  // Ground fill
  const gnd=ctx.createLinearGradient(0,grassLine,0,H);
  gnd.addColorStop(0,'hsl(100,12%,8%)');
  gnd.addColorStop(.3,'hsl(95,10%,6%)');
  gnd.addColorStop(1,'hsl(90,8%,4%)');
  ctx.fillStyle=gnd;ctx.fillRect(0,grassLine+5,W,H-grassLine);
}

// ═══ HORIZON GLOW ═══
function drawHorizonGlow(t){
  const breathe=Math.sin(t*.0004)*.1+1;
  const gY=H*.72;
  const g=ctx.createRadialGradient(W*.5,gY,0,W*.5,gY,W*.5*breathe);
  g.addColorStop(0,'hsla(30,50%,45%,.06)');
  g.addColorStop(.3,'hsla(25,45%,38%,.03)');
  g.addColorStop(1,'hsla(25,40%,35%,0)');
  ctx.fillStyle=g;ctx.beginPath();ctx.arc(W*.5,gY,W*.5*breathe,0,Math.PI*2);ctx.fill();
}

// ═══ ATMOSPHERIC DUST ═══
class MeadowDust{
  constructor(){this.x=Math.random()*W;this.y=H*.3+Math.random()*H*.5;this.sz=.3+Math.random()*.5;this.a=.03+Math.random()*.05;this.sp=.015+Math.random()*.03;this.an=Math.random()*Math.PI*2;this.no=Math.random()*200;this.tp=Math.random()*Math.PI*2;this.ts=.002+Math.random()*.004}
  update(t){const n=noise2D(this.no+t*.0002,this.y*.008);this.x+=Math.cos(this.an+n*2)*this.sp;this.y+=Math.sin(this.an+n)*this.sp;if(this.x<0)this.x=W;if(this.x>W)this.x=0;if(this.y<H*.25)this.y=H*.8;if(this.y>H*.85)this.y=H*.3}
  draw(t){const tw=.3+Math.sin(t*this.ts+this.tp)*.7;ctx.globalAlpha=this.a*tw;ctx.fillStyle='rgba(200,210,170,.6)';ctx.beginPath();ctx.arc(this.x,this.y,this.sz,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1}
}

// ═══ INIT ═══
const stars=Array.from({length:45},()=>new TwilightStar);
const fireflies=Array.from({length:20},()=>new Firefly);
const dust=Array.from({length:35},()=>new MeadowDust);
const touchFireflies=[];

// ═══ RENDER ═══
function render(){
  t++;mxS+=(mx-mxS)*.03;myS+=(my-myS)*.03;
  
  drawSky(t);
  stars.forEach(s=>s.draw(t));
  drawHorizonGlow(t);
  
  // Fireflies behind grass
  fireflies.forEach(f=>{f.update(t);f.draw(t)});
  touchFireflies.forEach(f=>{f.update(t);f.draw(t)});
  
  dust.forEach(d=>{d.update(t);d.draw(t)});
  drawGrass(t);
  
  // Some fireflies in front of grass too
  touchFireflies.forEach(f=>{if(f.y>H*.75){f.draw(t)}});
  
  // Cleanup
  for(let i=touchFireflies.length-1;i>=0;i--){
    touchFireflies[i].blinkSp*=.998; // slowly dim
    if(touchFireflies[i].blinkSp<.003)touchFireflies.splice(i,1);
  }
  
  requestAnimationFrame(render);
}
render();

document.getElementById('env').addEventListener('click',()=>{document.getElementById('env').classList.add('opened');setTimeout(()=>{document.getElementById('exp').classList.add('active');document.getElementById('env').style.display='none'},700)});

const pc=document.getElementById('pc'),pctx=pc.getContext('2d'),fl=document.getElementById('fl');
const FILTERS=['Original','Twilight','Firelit','Meadow Sketch','Golden Dusk'];let cf=0,oD;
function genP(w,h){const o=document.createElement('canvas');o.width=w;o.height=h;const c=o.getContext('2d');const bg=c.createLinearGradient(0,0,w,h);bg.addColorStop(0,'#3A4050');bg.addColorStop(.3,'#4A4838');bg.addColorStop(.6,'#3D4535');bg.addColorStop(1,'#2A3028');c.fillStyle=bg;c.fillRect(0,0,w,h);for(let i=0;i<10;i++){const x=w*.15+Math.random()*w*.7,y=h*.15+Math.random()*h*.7,r=20+Math.random()*50,g=c.createRadialGradient(x,y,0,x,y,r);g.addColorStop(0,`hsla(${80+Math.random()*30},25%,45%,.3)`);g.addColorStop(1,`hsla(${80+Math.random()*30},25%,45%,0)`);c.fillStyle=g;c.beginPath();c.arc(x,y,r,0,Math.PI*2);c.fill()}for(let i=0;i<2e3;i++){c.fillStyle=`rgba(200,210,170,${Math.random()*.04})`;c.fillRect(Math.random()*w,Math.random()*h,1,1)}c.font='300 15px "Cormorant Garamond",serif';c.textAlign='center';c.fillStyle='rgba(200,210,170,.3)';c.fillText('your photo here',w/2,h*.83);c.font='300 10px "Nunito Sans",sans-serif';c.fillText('(tap to see art filters)',w/2,h*.89);return o}
function initP(){const f=document.getElementById('pf'),s=f.offsetWidth||280;pc.width=s;pc.height=s;pctx.drawImage(genP(s,s),0,0);oD=pctx.getImageData(0,0,s,s)}
function apF(n){const w=pc.width,h=pc.height;pctx.putImageData(oD,0,0);if(n==='Original')return;const id=pctx.getImageData(0,0,w,h),d=id.data;
if(n==='Twilight'){for(let i=0;i<d.length;i+=4){d[i]=Math.min(255,d[i]*.85+8);d[i+1]=Math.min(255,d[i+1]*.9+12);d[i+2]=Math.min(255,d[i+2]*1.15+20)}pctx.putImageData(id,0,0);const v=pctx.createRadialGradient(w/2,h*.7,w*.1,w/2,h/2,w*.6);v.addColorStop(0,'rgba(200,180,120,.06)');v.addColorStop(1,'rgba(26,30,46,.15)');pctx.fillStyle=v;pctx.fillRect(0,0,w,h)}
else if(n==='Firelit'){for(let i=0;i<d.length;i+=4){d[i]=Math.min(255,d[i]*1.1+10);d[i+1]=Math.min(255,d[i+1]*1.05+5);d[i+2]=d[i+2]*.85}pctx.putImageData(id,0,0);for(let i=0;i<12;i++){const x=Math.random()*w,y=Math.random()*h,r=2+Math.random()*4,g=pctx.createRadialGradient(x,y,0,x,y,r*5);g.addColorStop(0,`rgba(200,210,120,${.06+Math.random()*.06})`);g.addColorStop(1,'rgba(200,210,120,0)');pctx.fillStyle=g;pctx.beginPath();pctx.arc(x,y,r*5,0,Math.PI*2);pctx.fill()}}
else if(n==='Meadow Sketch'){for(let i=0;i<d.length;i+=4){const g=(d[i]+d[i+1]+d[i+2])/3;d[i]=Math.min(255,g+15);d[i+1]=Math.min(255,g+18);d[i+2]=Math.min(255,g+10)}pctx.putImageData(id,0,0);pctx.fillStyle='rgba(245,240,232,.15)';pctx.fillRect(0,0,w,h);for(let i=0;i<2e3;i++){const x=Math.random()*w,y=Math.random()*h,l=3+Math.random()*10,a=-.2+Math.random()*.4;pctx.strokeStyle=`rgba(60,70,50,${.015+Math.random()*.03})`;pctx.lineWidth=.4;pctx.beginPath();pctx.moveTo(x,y);pctx.lineTo(x+Math.cos(a)*l,y+Math.sin(a)*l);pctx.stroke()}}
else if(n==='Golden Dusk'){for(let i=0;i<d.length;i+=4){d[i]=Math.min(255,d[i]*1.15+15);d[i+1]=Math.min(255,d[i+1]*1.08+10);d[i+2]=Math.min(255,d[i+2]*.8+5)}pctx.putImageData(id,0,0);pctx.globalAlpha=.2;for(let i=0;i<6;i++)pctx.drawImage(pc,(Math.random()-.5)*5,(Math.random()-.5)*5);pctx.globalAlpha=1;const v=pctx.createLinearGradient(0,0,0,h);v.addColorStop(0,'rgba(26,30,46,.1)');v.addColorStop(.5,'rgba(200,180,100,.06)');v.addColorStop(1,'rgba(200,160,80,.12)');pctx.fillStyle=v;pctx.fillRect(0,0,w,h)}}
document.getElementById('pf').addEventListener('click',e=>{cf=(cf+1)%FILTERS.length;pc.style.transition='opacity .3s';pc.style.opacity='.4';setTimeout(()=>{apF(FILTERS[cf]);fl.textContent=FILTERS[cf];pc.style.opacity='1'},250);spB(e.clientX,e.clientY)});
function spB(x,y){for(let i=0;i<5;i++){const f=new Firefly;f.x=x+(Math.random()-.5)*80;f.y=y+(Math.random()-.5)*60;f.targetX=f.x+(Math.random()-.5)*100;f.targetY=f.y+(Math.random()-.5)*80;f.blinkPh=Math.random()*Math.PI*2;touchFireflies.push(f)}}
document.addEventListener('click',e=>{if(e.target.closest('.envelope-screen')||e.target.closest('.photo-frame'))return;spB(e.clientX,e.clientY)});
document.fonts.ready.then(()=>setTimeout(initP,100));addEventListener('resize',()=>{resize();setTimeout(initP,100)});
</script>
</body>
</html>
